const MAKERS=['DMC','COSMO','Olympus'];const DATA_FILES={DMC:'data/dmc.json',COSMO:'data/cosmo.json',Olympus:'data/olympus.json'};const state={currentTab:'inventory',currentMaker:'DMC',data:{}};document.querySelectorAll('.tab-btn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-panel').forEach(x=>x.classList.remove('active'));b.classList.add('active');document.getElementById(b.dataset.tab).classList.add('active');if(b.dataset.tab==='inventory'){renderJump();renderList();}else{renderWishlist();}});function bindMaker(scope=document){scope.querySelectorAll('.maker-btn').forEach(btn=>btn.onclick=()=>{btn.parentElement.querySelectorAll('.maker-btn').forEach(x=>x.classList.remove('active'));btn.classList.add('active');if(state.currentTab==='inventory'){state.currentMaker=btn.dataset.maker;renderJump();renderList();}else{renderWishlist(btn.dataset.maker);}})}bindMaker(document);async function loadAll(){for(const m of MAKERS){const res=await fetch(DATA_FILES[m]);const j=await res.json();state.data[m]=j.items||[]}renderJump();renderList()}loadAll();const invKey=m=>`inventory:${m}`,wishKey=m=>`wishlist:${m}`;const getInv=m=>JSON.parse(localStorage.getItem(invKey(m))||'{}'),setInv=(m,o)=>localStorage.setItem(invKey(m),JSON.stringify(o));const getWish=m=>JSON.parse(localStorage.getItem(wishKey(m))||'[]'),setWish=(m,a)=>localStorage.setItem(wishKey(m),JSON.stringify(a));function leadingHundreds(s){const m=String(s||'').match(/^\d+/);if(!m)return 0;const n=parseInt(m[0],10);return Math.floor(n/100)*100}function sortItems(a){return a.slice().sort((x,y)=>{const nx=parseInt((String(x.number).match(/^\d+/)||['0'])[0],10);const ny=parseInt((String(y.number).match(/^\d+/)||['0'])[0],10);return nx-ny||String(x.number).localeCompare(String(y.number))})}function renderJump(){const bar=document.getElementById('jumpbar');bar.innerHTML='';const items=state.data[state.currentMaker]||[];[...new Set(items.map(it=>leadingHundreds(it.number)))].sort((a,b)=>a-b).forEach(s=>{const btn=document.createElement('button');btn.className='jump';btn.textContent=String(s);btn.onclick=()=>{const a=document.querySelector(`[data-anchor="${s}"]`);if(a)a.scrollIntoView({behavior:'smooth',block:'start'})};bar.appendChild(btn)})}function renderList(){const list=document.getElementById('list');list.innerHTML='';const maker=state.currentMaker;const items=sortItems(state.data[maker]||[]);const inv=getInv(maker);const wish=new Set(getWish(maker));let cur=null;items.forEach(it=>{const sec=leadingHundreds(it.number);const tpl=document.getElementById('card-template').content.cloneNode(true);const anchor=tpl.querySelector('.anchor');if(sec!==cur){cur=sec;anchor.setAttribute('data-anchor',sec);anchor.id=`sec-${sec}`}const sw=tpl.querySelector('.swatch');sw.style.setProperty('--yarn-color',it.hex||'#ccc');tpl.querySelector('.number').textContent=it.number;tpl.querySelector('.maker').textContent=maker;const qtyEl=tpl.querySelector('.qty');const minus=tpl.querySelector('.minus');const plus=tpl.querySelector('.plus');const heart=tpl.querySelector('.heart');const qty=parseInt(inv[it.number]||0,10);qtyEl.textContent=qty;plus.onclick=()=>{const invNow=getInv(maker);const cur=parseInt(invNow[it.number]||0,10);const nxt=cur+1;invNow[it.number]=nxt;setInv(maker,invNow);qtyEl.textContent=nxt};minus.onclick=()=>{const invNow=getInv(maker);const cur=parseInt(invNow[it.number]||0,10);const nxt=Math.max(0,cur-1);invNow[it.number]=nxt;setInv(maker,invNow);qtyEl.textContent=nxt};const wished=wish.has(it.number);heart.textContent=wished?'♥️':'♡';heart.onclick=()=>{const arr=new Set(getWish(maker));if(arr.has(it.number))arr.delete(it.number);else arr.add(it.number);setWish(maker,Array.from(arr));heart.textContent=arr.has(it.number)?'♥️':'♡'};list.appendChild(tpl)})}function renderWishlist(filter='ALL'){const box=document.getElementById('wishlist-list');box.innerHTML='';const makers=filter==='ALL'?MAKERS:[filter];makers.forEach(maker=>{const items=sortItems(state.data[maker]||[]);const wished=new Set(getWish(maker));const inv=getInv(maker);items.filter(it=>wished.has(it.number)).forEach(it=>{const tpl=document.getElementById('card-template').content.cloneNode(true);tpl.querySelector('.swatch').style.setProperty('--yarn-color',it.hex||'#ccc');tpl.querySelector('.number').textContent=it.number;tpl.querySelector('.maker').textContent=maker;const heart=tpl.querySelector('.heart');heart.textContent='♥️';heart.onclick=()=>{const arr=new Set(getWish(maker));arr.delete(it.number);setWish(maker,Array.from(arr));renderWishlist(filter)};const qtyEl=tpl.querySelector('.qty');const minus=tpl.querySelector('.minus');const plus=tpl.querySelector('.plus');const qty=parseInt(inv[it.number]||0,10);qtyEl.textContent=qty;plus.onclick=()=>{const invNow=getInv(maker);const cur=parseInt(invNow[it.number]||0,10);const nxt=cur+1;invNow[it.number]=nxt;setInv(maker,invNow);qtyEl.textContent=nxt};minus.onclick=()=>{const invNow=getInv(maker);const cur=parseInt(invNow[it.number]||0,10);const nxt=Math.max(0,cur-1);invNow[it.number]=nxt;setInv(maker,invNow);qtyEl.textContent=nxt};box.appendChild(tpl)})});const panel=document.getElementById('wishlist');panel.querySelectorAll('.maker-btn').forEach(b=>b.classList.remove('active'));const t=[...panel.querySelectorAll('.maker-btn')].find(b=>b.dataset.maker===filter);if(t)t.classList.add('active')}